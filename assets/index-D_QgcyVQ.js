(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&h(d)}).observe(document,{childList:!0,subtree:!0});function p(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function h(i){if(i.ep)return;i.ep=!0;const c=p(i);fetch(i.href,c)}})();window.onload=function(){if(typeof d3>"u"){console.error("D3 library not loaded");return}if(typeof topojson>"u"){console.error("TopoJSON library not loaded");return}console.log("Libraries loaded, initializing map...");var j=500,l=500,p=!0,h=[],i=d3.geo.path().projection(function(t){return t}).centroid,c=d3.geo.orthographic().scale(l/2).translate([j/2,l/2]).clipAngle(90),d=d3.geo.path().projection(c),x=d3.geo.graticule().extent([[-180,-90],[180-.1,90-.1]]),u=d3.select("body").append("svg").attr("width",j).attr("height",l).attr("cursor","grab");u.append("circle").attr("class","world-outline").attr("cx",j/2).attr("cy",l/2).attr("r",c.scale());var O=R();P(),S(),d3.json("https://s3-us-west-2.amazonaws.com/s.cdpn.io/95802/world-110m.json",function(t,e){if(t){console.error("Error loading world data:",t);return}if(console.log("World data loaded:",e),console.log("TopoJSON object:",topojson),!e||!e.objects||!e.objects.countries){console.error("Invalid world data structure");return}var o=topojson.object(e,e.objects.countries).geometries;h=o,console.log("Countries loaded:",o.length,"countries"),N(o),c.clipAngle(180);var a=u.append("path").datum(x).attr("class","back-line").attr("d",d),r=u.selectAll(".back-country").data(o).enter().insert("path",".back-line").attr("class","back-country").attr("d",d);c.clipAngle(90);var n=u.append("path").datum(x).attr("class","line").attr("d",d),s=u.selectAll(".country").data(o).enter().insert("path",".line").attr("class","country").attr("d",d),b=u.append("text").attr("x",j/2).attr("y",l*3/5);window.mapElements={backLine:a,backCountry:r,line:n,country:s,title:b,rotate:O,centroid:i,projection:c,path:d},L()});function P(){var t=document.querySelectorAll('input[name="mode"]'),e=document.getElementById("manual-controls"),o=document.getElementById("country-select");t.forEach(function(a){a.addEventListener("change",function(){this.value==="auto"?(p=!0,e.style.display="none",L()):(p=!1,e.style.display="block",T())})}),o.addEventListener("change",function(){this.value&&B(parseInt(this.value))})}function S(){var t=!1,e=[0,0],o=[0,0];u.on("mousedown",function(){t=!0,e=d3.mouse(this),u.attr("cursor","grabbing")}),u.on("mousemove",function(){if(!(!t||p)){var r=d3.mouse(this),n=r[0]-e[0],s=r[1]-e[1];o[0]=(o[0]+n*.5)%360,o[1]=Math.max(-90,Math.min(90,o[1]-s*.3)),a(o),e=r}}),u.on("mouseup",function(){t=!1,u.attr("cursor","grab")}),u.on("mouseleave",function(){t=!1,u.attr("cursor","grab")}),u.on("touchstart",function(){if(!p){t=!0;var r=d3.event.touches[0];e=[r.pageX,r.pageY],d3.event.preventDefault()}}),u.on("touchmove",function(){if(!(!t||p)){var r=d3.event.touches[0],n=[r.pageX,r.pageY],s=n[0]-e[0],b=n[1]-e[1];o[0]=(o[0]+s*.5)%360,o[1]=Math.max(-90,Math.min(90,o[1]-b*.3)),a(o),e=n,d3.event.preventDefault()}}),u.on("touchend",function(){t=!1});function a(r){if(window.mapElements){var n=window.mapElements;n.projection.rotate(r).clipAngle(180),n.backCountry.attr("d",n.path),n.backLine.attr("d",n.path),n.projection.rotate(r).clipAngle(90),n.country.attr("d",n.path),n.line.attr("d",n.path)}}}function N(t){var e=document.getElementById("country-select");console.log("Debug: Countries data:",t),console.log("Debug: Sample country IDs:",t.slice(0,5).map(function(o){return o.id})),e.innerHTML='<option value="">选择国家</option>',t.forEach(function(o,a){var r=document.createElement("option");r.value=a,console.log("Debug: Country",a,"ID:",o.id,"Type:",typeof o.id);var n=o.id||"Country "+(a+1);r.textContent=n,e.appendChild(r)}),console.log("Debug: Total options added:",t.length)}function L(){if(!window.mapElements)return;var t=window.mapElements,e=h,o=-1,a=e.length;function r(){p&&(++o>=a&&(o=0),t.country.transition().style("fill",function(n,s){return s===o?"red":"#737368"}),d3.transition().delay(250).duration(1250).tween("rotate",function(){var n=t.centroid(e[o]);return t.rotate.source(t.projection.rotate()).target([-n[0],-n[1]]).distance(),function(s){t.projection.rotate(t.rotate(s)).clipAngle(180),t.backCountry.attr("d",t.path),t.backLine.attr("d",t.path),t.projection.rotate(t.rotate(s)).clipAngle(90),t.country.attr("d",t.path),t.line.attr("d",t.path)}}).transition().each("end",r))}r()}function T(){d3.selectAll("svg *").transition().duration(0)}function B(t){if(!(!window.mapElements||t<0||t>=h.length)){var e=window.mapElements,o=h[t];e.country.style("fill","#737368"),e.country.filter(function(n,s){return s===t}).style("fill","red");var a=e.centroid(o),r=[-a[0],-a[1]];d3.transition().duration(1250).tween("rotate",function(){return e.rotate.source(e.projection.rotate()).target(r).distance(),function(n){e.projection.rotate(e.rotate(n)).clipAngle(180),e.backCountry.attr("d",e.path),e.backLine.attr("d",e.path),e.projection.rotate(e.rotate(n)).clipAngle(90),e.country.attr("d",e.path),e.line.attr("d",e.path)}})}}var m=Math.PI/180;function R(){var t,e,o,a,r,n,s,b,w,A,D,I,g,E;function M(f){var v=Math.sin(f*=g)*E,y=Math.sin(g-f)*E,k=y*r+v*D,C=y*n+v*I,q=y*a+v*A;return[Math.atan2(C,k)/m,Math.atan2(q,Math.sqrt(k*k+C*C))/m]}return M.distance=function(){return g==null&&(E=1/Math.sin(g=Math.acos(Math.max(-1,Math.min(1,a*A+o*w*Math.cos(s-t)))))),g},M.source=function(f){var v=Math.cos(t=f[0]*m),y=Math.sin(t);return o=Math.cos(e=f[1]*m),a=Math.sin(e),r=o*v,n=o*y,g=null,M},M.target=function(f){var v=Math.cos(s=f[0]*m),y=Math.sin(s);return w=Math.cos(b=f[1]*m),A=Math.sin(b),D=w*v,I=w*y,g=null,M},M}};
